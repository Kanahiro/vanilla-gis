{% extends "layout.html" %}
{% block content %}
<div id='import_section' ondragover="onDragOver(event)" ondrop="onDrop(event)">
	<div id='map_container' style='width:100%;height:100%'></div>
</div>
<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/leaflet.css')}}">
<script type='text/javascript' src='{{url_for("static", filename="js/leaflet/leaflet.js")}}'></script>
<script type='text/javascript' src='{{url_for("static", filename="js/leaflet/Leaflet.Control.Custom.js")}}'></script>
<script type='text/javascript' src='{{url_for("static", filename="js/index/mapConfig.js")}}'></script>
<script type='text/javascript' src='{{url_for("static", filename="js/index/dataImport.js")}}'></script>
<script type='text/javascript' src='{{url_for("static", filename="js/index/dataExport.js")}}'></script>
<script type='text/javascript'>
	//URLパラメータで取得した値でDBからマップタイトル、作者名、マップIDを取得した後の処理
	//他のコンテンツが読み込まれたタイミングで発火
	window.onload = function(){
		miniWindowChanger("https://www.asus.com/support/images/support-loading.gif");
		mapTitle = "{{map_title}}";
		authorName = "{{author_name}}";
		//APIからGEOJSON取得処理
		var formdata = new FormData();
		formdata.append('map_id', "{{id}}");
		fetch("/user_map",{
		    method:"POST",
		    body:formdata
		})
		.then(function(response1) {
		    console.log("status=" + response1.status); //例 200
		    return response1.json();
		})
		.then(function(jsons) {
			for (num in jsons) {
				addGeojson(jsons[num]);
			}
		})
		.catch(function(err1) {
		    console.log("err=" + err1);
		    alert('Import Error');
		    miniWindowChanger("");
		});
	};
</script>
{% endblock %}